<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">אור בפרשה</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&family=Noto+Serif+Hebrew:wght@700&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        beigeTheme: '#f1dcc1',
                    },
                    fontFamily: {
                        sans: ['Heebo', 'sans-serif'],
                        serif: ['Noto Serif Hebrew', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @font-face {
            font-family: 'OHLiorAtias';
            src: url('OHLiorAtias-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body { 
            background: linear-gradient(to bottom, white 0%, white 15%, #f1dcc1 60%, #f1dcc1 100%);
            margin: 0; 
            overflow-x: hidden; 
            min-height: 100vh;
        }
        .floating-card { 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            background-color: white; 
        }
        .floating-card:hover { 
            box-shadow: 0 25px 45px -10px rgba(0, 0, 0, 0.12), 0 15px 20px -5px rgba(0, 0, 0, 0.05);
            transform: translateY(-8px);
        }
        .image-fallback {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,0,0,0.05));
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hero-mask {
            mask-image: linear-gradient(to bottom, black 75%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 75%, transparent 100%);
        }
        .hero-gradient-fallback {
            background: linear-gradient(180deg, var(--book-color-dark) 0%, var(--book-color-light) 100%);
        }
        
        .custom-subtitle-font {
            font-family: 'OHLiorAtias', sans-serif;
        }
    </style>
</head>
<body class="font-sans antialiased text-slate-800">

    <div id="hero-section" class="fixed top-0 left-0 w-full h-[60vh] md:h-[80vh] z-0 overflow-hidden hero-mask">
        <div id="hero-bg" class="absolute inset-0 bg-cover bg-center transition-opacity duration-700"></div>
        <div id="hero-overlay" class="absolute inset-0 bg-black/25"></div>
        
        <div class="absolute top-8 right-8 z-20">
            <a href="index.html" id="back-link" class="inline-flex items-center gap-2 font-bold text-sm bg-white/20 backdrop-blur-md px-5 py-2.5 rounded-full hover:bg-white/40 transition-all no-underline text-white border border-white/30">
                <span class="material-symbols-outlined text-lg">arrow_forward</span>
                חזרה
            </a>
        </div>

        <div id="hero-content" class="absolute inset-0 flex flex-col items-center justify-start pt-28 md:justify-center md:pt-0 text-white text-center px-6">
            <div id="icon-container" class="w-20 h-20 rounded-full mb-6 shadow-2xl border-4 border-white/80 flex items-center justify-center">
                <span id="book-icon" class="material-symbols-outlined text-4xl"></span>
            </div>
            <h1 id="main-title" class="text-5xl md:text-7xl font-serif font-bold drop-shadow-2xl mb-4"></h1>
            <p id="main-description" class="text-xl md:text-2xl font-light max-w-2xl opacity-95 leading-relaxed drop-shadow-lg"></p>
        </div>
    </div>

    <div class="relative z-10 mt-[60vh] md:mt-[85vh]">
        <div class="pb-24 px-6">
            <main class="max-w-4xl mx-auto">
                <div id="parasha-grid" class="flex flex-col gap-8">
                    <div id="loader" class="text-center py-10 opacity-50">טוען מאמרים...</div>
                </div>
            </main>
        </div>

        <footer class="py-12 text-center text-slate-500 text-xs tracking-widest border-t border-black/5">
            &copy; 2026 • אור בפרשה
        </footer>
    </div>

    <script>
        const booksConfig = {
            'bereshit': { name: 'ספר בראשית', desc: 'יסודות האמונה ובניית המשפחה היהודית הראשונה.', color: '#10b981', lightColor: '#065f46', icon: 'public', hero: 'images/bereshit_cover.jpg', folder: 'bereshit', parashotNames: ['Bereshit', 'Noach', 'Lech Lecha', 'Vayeira', 'Chayei Sarah', 'Toledot', 'Vayetzei', 'Vayishlach', 'Vayeshev', 'Miketz', 'Vayigash', 'Vayechi'] },
            'shmot': { name: 'ספר שמות', desc: 'מיציאה מעבדות לחירות, מעמד הר סיני ובניית המשכן.', color: '#f97316', lightColor: '#9a3412', icon: 'local_fire_department', hero: 'https://images.unsplash.com/photo-1502481851512-e9e2529bbbf9?q=80&w=1600', folder: 'shmot', parashotNames: ['Shemot', 'Vaera', 'Bo', 'Beshalach', 'Yitro', 'Mishpatim', 'Terumah', 'Tetzaveh', 'Ki Tisa', 'Vayakhel', 'Pekudei'] },
            'vaikra': { name: 'ספר ויקרא', desc: 'עבודת המקדש, הקדושה והחובות המוסריות.', color: '#a855f7', lightColor: '#6b21a8', icon: 'temple_hindu', hero: 'https://images.unsplash.com/photo-1519817650390-64a93db51149?q=80&w=1600', folder: 'vaikra', parashotNames: ['Vayikra', 'Tzav', 'Shemini', 'Tazria', 'Metzora', 'Acharei Mot', 'Kedoshim', 'Emor', 'Behar', 'Bechukotai'] },
            'bamidbar': { name: 'ספר במדבר', desc: 'מסע בני ישראל במדבר סיני אל הארץ המובטחת.', color: '#d97706', lightColor: '#92400e', icon: 'landscape', hero: 'https://images.unsplash.com/photo-1473580044384-7ba9967e16a0?q=80&w=1600', folder: 'bamidbar', parashotNames: ['Bamidbar', 'Nasso', 'Beha\'alotcha', 'Shelach', 'Korach', 'Chukat', 'Balak', 'Pinchas', 'Matot', 'Masei'] },
            'devarim': { name: 'ספר דברים', desc: 'נאום הפרידה של משה רבנו וסיכום המצוות.', color: '#0284c7', lightColor: '#075985', icon: 'record_voice_over', hero: 'https://images.unsplash.com/photo-1490682143124-b73ed7311835?q=80&w=1600', folder: 'devarim', parashotNames: ['Devarim', 'Va\'etchanan', 'Eikev', 'Reeh', 'Shoftim', 'Ki Teitzei', 'Ki Tavo', 'Nitzavim', 'Vayeilech', 'Haazinu', 'VZot HaBerachah'] }
        };

        function handleImageError(imgElement, color) {
            const container = imgElement.parentElement;
            imgElement.style.display = 'none';
            container.classList.add('image-fallback');
            container.style.background = `linear-gradient(135deg, ${color}22, ${color}44)`;
            container.innerHTML = `<span class="material-symbols-outlined text-4xl" style="color: ${color}88">menu_book</span>`;
        }

        function parseArticle(text) {
            const lines = text.split('\n');
            const data = { id: '', title: '', subtitle: '', image: '', hasContent: false, date: '', time: '' };
            let contentStarted = false;
            let bodyText = "";

            lines.forEach(line => {
                const cleanLine = line.trim();
                if (cleanLine === '---') { contentStarted = true; return; }
                if (!contentStarted) {
                    if (cleanLine.startsWith('id:')) data.id = cleanLine.replace('id:', '').trim();
                    else if (cleanLine.startsWith('title:')) data.title = cleanLine.replace('title:', '').trim();
                    else if (cleanLine.startsWith('subtitle:')) data.subtitle = cleanLine.replace('subtitle:', '').trim();
                    else if (cleanLine.startsWith('image:')) data.image = cleanLine.replace('image:', '').trim();
                    else if (cleanLine.startsWith('date:')) data.date = cleanLine.replace('date:', '').trim();
                    else if (cleanLine.startsWith('time:')) data.time = cleanLine.replace('time:', '').trim();
                } else { bodyText += cleanLine; }
            });
            data.hasContent = bodyText.length > 0;
            return data;
        }

        async function initPage() {
            const params = new URLSearchParams(window.location.search);
            const bookId = params.get('book') || 'bereshit';
            const config = booksConfig[bookId] || booksConfig['bereshit'];

            document.getElementById('page-title').textContent = config.name;
            document.getElementById('main-title').textContent = config.name;
            document.getElementById('main-description').textContent = config.desc;
            
            const heroBg = document.getElementById('hero-bg');
            const heroSection = document.getElementById('hero-section');
            if (config.hero) { heroBg.style.backgroundImage = `url('${config.hero}')`; } 
            else {
                heroBg.style.opacity = '0';
                heroSection.style.setProperty('--book-color-dark', config.lightColor);
                heroSection.style.setProperty('--book-color-light', config.color);
                heroSection.classList.add('hero-gradient-fallback');
            }
            document.getElementById('icon-container').style.backgroundColor = config.color;
            document.getElementById('book-icon').textContent = config.icon;

            const grid = document.getElementById('parasha-grid');
            grid.innerHTML = '';
            let articleFound = false;

            const fetchPromises = [];
            config.parashotNames.forEach(pName => {
                const safeFileName = pName.replace(/\s+/g, '_');
                for (let i = 1; i <= 20; i++) {
                    const fileName = `${safeFileName}_${i}.txt`;
                    fetchPromises.push(fetch(`parashot/${config.folder}/${fileName}`).then(res => res.ok ? res.text() : null).catch(() => null));
                }
            });

            const results = await Promise.all(fetchPromises);
            const subtitleColor = config.lightColor;

            results.forEach((textContent) => {
                if (!textContent) return;
                const article = parseArticle(textContent);
                if (!article.hasContent || !article.id) return;

                articleFound = true;
                const card = document.createElement('div');
                const gradientFrame = `linear-gradient(135deg, ${config.color}, ${config.lightColor})`;

                card.innerHTML = `
                    <a href="article.html?parasha=${article.id}&book=${bookId}" 
                       class="group relative p-[1.5px] rounded-3xl no-underline floating-card overflow-hidden block">
                        <div class="card-inner-bg relative rounded-[calc(1.5rem-1.5px)] overflow-hidden flex items-center p-3 md:p-5 bg-white">
                            
                            <div class="w-24 h-24 md:w-40 md:h-40 overflow-hidden flex-shrink-0 rounded-2xl shadow-inner border border-black/5 relative bg-slate-50">
                                <img src="${article.image}" id="img-${article.id}" onerror="handleImageError(this, '${config.color}')" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000">
                            </div>

                            <div class="mr-4 md:mr-8 flex flex-col justify-between h-24 md:h-40 flex-grow py-1">
                                <div class="flex flex-col gap-0.5">
                                    <h3 class="text-xl md:text-3xl font-bold truncate leading-tight" style="color: ${config.color}">
                                        ${article.title}
                                    </h3>
                                    <p class="custom-subtitle-font text-lg md:text-2xl truncate opacity-90" style="color: ${subtitleColor}">
                                        ${article.subtitle}
                                    </p>
                                </div>

                                <div class="flex items-center">
                                    <span class="text-[10px] md:text-xs font-bold px-2 py-0.5 rounded-md border" 
                                          style="color: ${config.color}; border-color: ${config.color}33; background-color: ${config.color}05;">
                                        ${article.date}
                                    </span>
                                </div>
                            </div>

                            <div class="flex items-center px-2 md:px-6">
                                <span class="material-symbols-outlined text-sm md:text-base opacity-20 group-hover:opacity-100 group-hover:translate-x-[-3px] transition-all duration-500" style="color: ${config.color}">arrow_back_ios</span>
                            </div>
                        </div>
                        <div class="absolute inset-0 rounded-3xl pointer-events-none" style="border: 1.5px solid transparent; background: ${gradientFrame} border-box; -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude;"></div>
                    </a>
                `;
                grid.appendChild(card);
            });

            if (!articleFound) {
                grid.innerHTML = '<div class="text-center py-20 text-slate-500">בקרוב יעלו מאמרים חדשים לספר זה.</div>';
            }
        }

        window.addEventListener('scroll', () => {
            const scroll = window.scrollY;
            const heroContent = document.getElementById('hero-content'), backBtn = document.getElementById('back-link'), heroBg = document.getElementById('hero-bg');
            const opacityValue = Math.max(0, 1 - scroll / 450), blurValue = Math.min(20, scroll / 12);
            if(heroContent) { heroContent.style.opacity = opacityValue; heroContent.style.filter = `blur(${blurValue}px)`; }
            if(backBtn) backBtn.style.opacity = opacityValue;
            if (heroBg) { heroBg.style.filter = `blur(${blurValue / 2}px)`; heroBg.style.transform = `scale(${1 + scroll / 1200})`; }
        });

        initPage();
    </script>
</body>
</html>
